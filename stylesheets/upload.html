<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>upload test</title>
	<!-- Combo-handled YUI CSS files: -->
	<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/combo?2.6.0/build/reset-fonts/reset-fonts.css&2.6.0/build/container/assets/skins/sam/container.css&2.6.0/build/treeview/assets/skins/sam/treeview.css">
	<link rel="stylesheet" type="text/css" href="/stylesheets/main.css">
<!--[if IE]>
<style type="text/css"> 
/* place css fixes for all versions of IE in this conditional comment */
.twoColElsLtHdr #sidebar1 { padding-top: 30px; }
.twoColElsLtHdr #mainContent { zoom: 1; padding-top: 15px; }
/* the above proprietary zoom property gives IE the hasLayout it needs to avoid several bugs */
</style>
<![endif]--></head>
<body>

<form id="imageForm" action="/upload" enctype="multipart/form-data" method="post">
<table class="imageUploadForm">
<tr><th>Upload A New Image</th></tr>
<tr><td><input id="imageData" type="file" name="imageData" /></td></tr>
<tr><td>Image name: <input id="imageName" type="text" name="imageName" value="imageName"/></td></tr>
<tr><td><input type="submit" value="Use / Upload / Rename Image"></td></tr></table>
<input type="hidden" name="myPageKey" value="aglpc3Rvcnl3ZWJyCgsSBFBhZ2UYAgw">
<input type="hidden" name="myPageOrder" value="1">
</form>

<script type="text/javascript" src="http://yui.yahooapis.com/combo?2.6.0/build/utilities/utilities.js&2.6.0/build/container/container.js&2.6.0/build/json/json.js"></script>
<script type="text/javascript">

YAHOO.util.Event.onDOMReady(treeInit);

function treeInit() {
	YAHOO.util.Event.on('imageForm', 'submit', function(e) {
		alert('imageForm: stopped event');
		YAHOO.util.Event.stopEvent(e);
		uploadImage();
	});
}

var uploadImage = function() {
	var formID = 'imageForm';


	//do this shit because safari doesn't like forms with blank image content
	//var imageData = YAHOO.util.Dom.get('imageData');
	//var formHasImageContent = false;
	//if (imageData.value) { formHasImageContent = true; }
	var imageForm = YAHOO.util.Dom.get('imageForm');
	var imageName = YAHOO.util.Dom.get('imageName');
	var imageData = YAHOO.util.Dom.get('imageData');
	alert(imageForm);
	//alert(YAHOO.util.Connect.setForm('imageForm', true));
	//save the index for later and upload the image data
	alert('uploading data');
	//var myHTML = 'imageData=' + imageData.value
	var myHTML = 'imageName=' + imageName.value
			  + '&myPageKey=' + 'aglpc3Rvcnl3ZWJyCgsSBFBhZ2UYAgw'
			  + '&myPageOrder=' + '1';
	alert(myHTML);
	YAHOO.util.Connect.setForm('imageForm', true);
	YAHOO.util.Connect.asyncRequest('POST', '/upload', uploadImageCallbacks, myHTML);
}

var uploadImageCallbacks = {
	upload : function (o) {
		alert("upload success");
	},
	success : function (o) {
		alert("success success");
	},
	failure : function (o) {
		alert("uploadImage was not successful.");
	},
	argument : {
		"nodeIndex": null
	},
	timeout : 3000
}

</script>
</body>
</html>