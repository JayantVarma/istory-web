<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>upload test</title>
</head>
<body>

<form id="imageForm" action="/upload" enctype="multipart/form-data" method="post">
<table class="imageUploadForm">
<tr><th>Upload A New Image</th></tr>
<tr><td><input id="imageData" type="file" name="imageData" /></td></tr>
<tr><td>Image name: <input id="imageName" type="text" name="imageName" value="file name"/></td></tr>
<tr><td><input id="uploadButton" type="submit" value="GO!"></td></tr></table>
</form>

<!-- Combo-handled YUI JS files: -->
<script type="text/javascript" src="http://yui.yahooapis.com/2.6.0/build/utilities/utilities.js"></script>
<script type="text/javascript">

YAHOO.util.Event.onDOMReady(treeInit);

function treeInit() {
	YAHOO.util.Event.on('imageForm', 'submit', function(e) {
		alert('imageForm: SUBMIT stopped event');
		YAHOO.util.Event.stopEvent(e);
		uploadImage();
	});
	YAHOO.util.Event.on('uploadButton', 'click', function(e) {
		alert('imageForm: BUTTON stopped event');
		YAHOO.util.Event.stopEvent(e);
		uploadImage();
	});
}

var uploadImage = function() {
	var formID = 'imageForm';
	//do this shit because safari doesn't like forms with blank image content
	var imageData = YAHOO.util.Dom.get('imageData');
	var formHasImageContent = false;
	if (imageData.value) { formHasImageContent = true; }
	var imageForm = YAHOO.util.Dom.get('imageForm');
	alert(imageForm + ': ' + YAHOO.util.Connect.setForm('imageForm', formHasImageContent));
	YAHOO.util.Connect.asyncRequest('POST', '/upload', uploadImageCallbacks);
}

var uploadImageCallbacks = {
	upload : function (o) {
		alert('UPLOAD SUCCESS!: ' + o.responseText);
	},
	success : function (o) {
		alert('SUCCESS SUCCESS!: ' + o.responseText);
	},
	failure : function (o) {
		alert("uploadImage was not successful.");
	},
	argument : {
		"nodeIndex": null
	},
	timeout : 3000
}

</script>
</body>
</html>